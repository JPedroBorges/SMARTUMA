import MSCartesian from'./mscartesian';import canvasFactory from'../_internal/factories/gantt-canvas';import ganttAxisFactory from'../_internal/factories/gantt-axis';import Milestone from'../_internal/datasets/gantt/milestone';import Task from'../_internal/datasets/gantt/task';import Connector from'../_internal/datasets/gantt/connector';import datasetFactory from'../_internal/factories/gantt-dataset';import{pluckNumber,defaultGaugePaletteOptions,pluck,extend2,chartPaletteStr,pluckFontSize,POSITION_BOTTOM,setAttribDefs,attrTypeBool,attrTypeNum,dropHash,toRaphaelColor}from'../_internal/lib/lib';import{getLightColor}from'../_internal/lib/lib-graphics';import{getDep}from'../_internal/dependency-manager';let UNDEF,mathMax=Math.max,mathMin=Math.min,R=getDep('redraphael','plugin'),_scrollBar=function(){var a=[];return{get:function(){return a},clear:function(){a.length=0},add:function(b,c){a.push({conf:b,handler:c})}}}();setAttribDefs&&setAttribDefs({showpercentlabel:{type:attrTypeBool,pAttr:'showpercentlabel'},fontsize:{type:attrTypeNum},alpha:{type:attrTypeNum},showborder:{type:attrTypeBool},borderthickness:{type:attrTypeNum},borderalpha:{type:attrTypeNum},showHoverEffect:{type:attrTypeNum},hoverFillAlpha:{type:attrTypeNum},slackHoverFillColor:{type:attrTypeNum},slackHoverFillAlpha:{type:attrTypeBool},showlabels:{type:attrTypeBool,pAttr:'showtasknames'},slackfillcolor:{pAttr:'slackfillcolor'},showtasklabels:{type:attrTypeBool,pAttr:'showtasknames'},showtasknames:{type:attrTypeBool,pAttr:'showlabels'},showconnectorhovereffect:{type:attrTypeNum,pAttr:'showhovereffect'},connectorextension:{type:attrTypeNum},tasklabelspadding:{type:attrTypeNum},taskdatepadding:{type:attrTypeNum},showstartdate:{type:attrTypeNum,pAttr:'showtaskstartdate'},showenddate:{type:attrTypeNum,pAttr:'showtaskenddate'},showtaskhovereffect:{type:attrTypeNum,pAttr:'showhovereffect'},useverticalscrolling:{type:attrTypeNum},taskbarroundradius:{type:attrTypeNum},showshadow:{type:attrTypeNum},showslackasfill:{type:attrTypeNum}});class Gantt extends MSCartesian{constructor(){super(),this._scrollBar=_scrollBar,this.components={},this.fireGroupEvent=!0,this.hasInteractiveLegend=!1,this.defaultPaletteOptions=extend2(extend2({},defaultGaugePaletteOptions),{paletteColors:[['AFD8F8','F6BD0F','8BBA00','FF8E46','008E8E','D64646','8E468E','588526','B3AA00','008ED6','9D080D','A186BE','CC6600','FDC689','ABA000','F26D7D','FFF200','0054A6','F7941C','CC3300','006600','663300','6DCFF6'],['AFD8F8','F6BD0F','8BBA00','FF8E46','008E8E','D64646','8E468E','588526','B3AA00','008ED6','9D080D','A186BE','CC6600','FDC689','ABA000','F26D7D','FFF200','0054A6','F7941C','CC3300','006600','663300','6DCFF6'],['AFD8F8','F6BD0F','8BBA00','FF8E46','008E8E','D64646','8E468E','588526','B3AA00','008ED6','9D080D','A186BE','CC6600','FDC689','ABA000','F26D7D','FFF200','0054A6','F7941C','CC3300','006600','663300','6DCFF6'],['AFD8F8','F6BD0F','8BBA00','FF8E46','008E8E','D64646','8E468E','588526','B3AA00','008ED6','9D080D','A186BE','CC6600','FDC689','ABA000','F26D7D','FFF200','0054A6','F7941C','CC3300','006600','663300','6DCFF6'],['AFD8F8','F6BD0F','8BBA00','FF8E46','008E8E','D64646','8E468E','588526','B3AA00','008ED6','9D080D','A186BE','CC6600','FDC689','ABA000','F26D7D','FFF200','0054A6','F7941C','CC3300','006600','663300','6DCFF6']],bgColor:['FFFFFF','FFFFFF','FFFFFF','FFFFFF','FFFFFF'],bgAngle:[270,270,270,270,270],bgRatio:['100','100','100','100','100'],bgAlpha:['100','100','100','100','100'],canvasBgColor:['FFFFFF','FFFFFF','FFFFFF','FFFFFF','FFFFFF'],canvasBgAngle:[0,0,0,0,0],canvasBgAlpha:['100','100','100','100','100'],canvasBgRatio:['','','','',''],canvasBorderColor:['545454','545454','415D6F','845001','68001B'],canvasBorderAlpha:[100,100,100,90,100],gridColor:['DDDDDD','D8DCC5','99C4CD','DEC49C','FEC1D0'],gridResizeBarColor:['999999','545454','415D6F','845001','D55979'],categoryBgColor:['F1F1F1','EEF0E6','F2F8F9','F7F0E6','FFF4F8'],dataTableBgColor:['F1F1F1','EEF0E6','F2F8F9','F7F0E6','FFF4F8'],toolTipBgColor:['FFFFFF','FFFFFF','FFFFFF','FFFFFF','FFFFFF'],toolTipBorderColor:['545454','545454','415D6F','845001','68001B'],baseFontColor:['555555','60634E','025B6A','A15E01','68001B'],borderColor:['767575','545454','415D6F','845001','68001B'],borderAlpha:[50,50,50,50,50],legendBgColor:['ffffff','ffffff','ffffff','ffffff','ffffff'],legendBorderColor:['666666','545454','415D6F','845001','D55979'],plotBorderColor:['999999','8A8A8A','6BA9B6','C1934D','FC819F'],plotFillColor:['EEEEEE','D8DCC5','BCD8DE','E9D8BE','FEDAE3'],scrollBarColor:['EEEEEE','D8DCC5','99C4CD','DEC49C','FEC1D0']}),this.registerFactory('canvas',canvasFactory),this.registerFactory('axis',ganttAxisFactory,['canvas']),this.registerFactory('dataset',datasetFactory,['canvas'])}static getName(){return'Gantt'}draw(){super.draw(),this.drawScrollBar()}getName(){return'Gantt'}__setDefaultConfig(){super.__setDefaultConfig();let a=this.config;a.alignCaptionWithCanvas=0,a.defaultDatasetType='task',a.taskbarroundradius=0,a.taskbarfillmix=' { light-10 }, { dark-20 }, { light-50 }, { light-85 }',a.taskbarfillratio='0,8,84,8',a.showslackasfill=1,a.dateintooltip=1,a.tasklabelsalign='center',a.datepadding=3,a.showtasknames=0,a.showpercentlabel=!1,a.showhovereffect=1,a.slackfillcolor='FF5E5E',a.connectorextension=10,a.tasklabelspadding=2,a.taskdatepadding=3,a.showlabels=UNDEF,a.showtooltip=1,a.showtaskhovereffect=UNDEF,a.useverticalscrolling=1,a.ganttpanedurationunit=UNDEF,a.ganttpaneduration=UNDEF,a.showtaskstartdate=UNDEF,a.showtaskenddate=UNDEF,a.ganttwidthpercent=UNDEF,a.showshadow=1,a.enablemousetracking=!1}_checkInvalidSpecificData(){let a=this.getFromEnv('dataSource'),b=a.processes,c=b&&b.process,d=c&&c.length,e=a.tasks,f=e&&e.task||e,g=f&&f.length,h=a.categories,i=h&&h[0]&&h[0].category,j=i&&i.length;return!d||!g||!j}parseChartAttr(a){let b=this.config,c=a&&a.chart||this.getFromEnv('chart-attrib');super.parseChartAttr(a),b.showBorder=pluckNumber(c.showborder,0),b.alignLegendWithCanvas=0}_feedAxesRawData(){let a=this.getFromEnv('color-manager'),b=this.getFromEnv('dataSource'),c=b.chart,d=this.is3d,e=d?chartPaletteStr.chart3D:chartPaletteStr.chart2D;return{xAxisConf:[{isVertical:!1,isReverse:!1,isOpposit:!0,outCanfontFamily:pluck(c.outcnvbasefont,c.basefont,'Verdana,sans'),outCanfontSize:pluckFontSize(c.outcnvbasefontsize,c.basefontsize,10),outCancolor:pluck(c.outcnvbasefontcolor,c.basefontcolor,a.getColor(e.baseFontColor)).replace(/^#? ([a-f0-9]+)/ig,'#$1'),axisBreaks:c.xaxisbreaks,axisNamePadding:c.xaxisnamepadding,axisValuePadding:c.labelpadding,axisNameFont:c.xaxisnamefont,axisNameFontSize:c.xaxisnamefontsize,axisNameFontColor:c.xaxisnamefontcolor,axisNameFontBold:c.xaxisnamefontbold,axisNameFontItalic:c.xaxisnamefontitalic,axisNameBgColor:c.xaxisnamebgcolor,axisNameBorderColor:c.xaxisnamebordercolor,axisNameAlpha:c.xaxisnamealpha,axisNameFontAlpha:c.xaxisnamefontalpha,axisNameBgAlpha:c.xaxisnamebgalpha,axisNameBorderAlpha:c.xaxisnameborderalpha,axisNameBorderPadding:c.xaxisnameborderpadding,axisNameBorderRadius:c.xaxisnameborderradius,axisNameBorderThickness:c.xaxisnameborderthickness,axisNameBorderDashed:c.xaxisnameborderdashed,axisNameBorderDashLen:c.xaxisnameborderdashlen,axisNameBorderDashGap:c.xaxisnameborderdashgap,useEllipsesWhenOverflow:c.useellipseswhenoverflow,divLineColor:pluck(c.vdivlinecolor,a.getColor(e.divLineColor)),divLineAlpha:pluck(c.vdivlinealpha,d?a.getColor('divLineAlpha3D'):a.getColor('divLineAlpha')),divLineThickness:pluckNumber(c.vdivlinethickness,1),divLineIsDashed:!!pluckNumber(c.vdivlinedashed,c.vdivlineisdashed,0),divLineDashLen:pluckNumber(c.vdivlinedashlen,4),divLineDashGap:pluckNumber(c.vdivlinedashgap,2),showAlternateGridColor:pluckNumber(c.showalternatevgridcolor,0),alternateGridColor:pluck(c.alternatevgridcolor,a.getColor('altVGridColor')),alternateGridAlpha:pluck(c.alternatevgridalpha,a.getColor('altVGridAlpha')),numDivLines:pluckNumber(c.numvdivlines,this.config.numVDivLines),labelFont:c.labelfont,labelFontSize:c.labelfontsize,labelFontColor:c.labelfontcolor,labelFontAlpha:c.labelalpha,labelFontBold:c.labelfontbold,labelFontItalic:c.labelfontitalic,maxLabelHeight:c.maxlabelheight,axisName:c.xaxisname,axisMinValue:c.xaxisminvalue,axisMaxValue:c.xaxismaxvalue,setAdaptiveMin:c.setadaptivexmin,adjustDiv:c.adjustvdiv,labelDisplay:c.labeldisplay,showLabels:c.showlabels,rotateLabels:c.rotatelabels,slantLabel:pluckNumber(c.slantlabels,c.slantlabel),labelStep:pluckNumber(c.labelstep,c.xaxisvaluesstep),showAxisValues:pluckNumber(c.showxaxisvalues,c.showxaxisvalue),showLimits:pluckNumber(c.showvlimits,this.config.showvlimits),showDivLineValues:pluckNumber(c.showvdivlinevalues,c.showvdivlinevalues),zeroPlaneColor:c.vzeroplanecolor,zeroPlaneThickness:c.vzeroplanethickness||2,zeroPlaneAlpha:c.vzeroplanealpha,showZeroPlaneValue:c.showvzeroplanevalue,vTrendLines:b.trendlines,trendlineColor:c.trendlinecolor,trendlineToolText:c.trendlinetooltext,trendlineThickness:c.trendlinethickness,trendlineAlpha:c.trendlinealpha,showTrendlinesOnTop:c.showtrendlinesontop,showAxisLine:pluckNumber(c.showxaxisline,c.showaxislines,c.drawAxisLines,0),axisLineThickness:pluckNumber(c.xaxislinethickness,c.axislinethickness,1),axisLineAlpha:pluckNumber(c.xaxislinealpha,c.axislinealpha,100),axisLineColor:pluck(c.xaxislinecolor,c.axislinecolor,'#000000')}],yAxisConf:[{isVertical:!0,isReverse:!0,isOpposit:!1,outCanfontFamily:pluck(c.outcnvbasefont,c.basefont,'Verdana,sans'),outCanfontSize:pluckFontSize(c.outcnvbasefontsize,c.basefontsize,10),outCancolor:pluck(c.outcnvbasefontcolor,c.basefontcolor,a.getColor(e.baseFontColor)).replace(/^#? ([a-f0-9]+)/ig,'#$1'),axisBreaks:c.yaxisbreaks,axisNamePadding:c.yaxisnamepadding,axisValuePadding:c.yaxisvaluespadding,axisNameFont:c.yaxisnamefont,axisNameFontSize:c.yaxisnamefontsize,axisNameFontColor:c.yaxisnamefontcolor,axisNameFontBold:c.yaxisnamefontbold,axisNameFontItalic:c.yaxisnamefontitalic,axisNameBgColor:c.yaxisnamebgcolor,axisNameBorderColor:c.yaxisnamebordercolor,axisNameAlpha:c.yaxisnamealpha,axisNameFontAlpha:c.yaxisnamefontalpha,axisNameBgAlpha:c.yaxisnamebgalpha,axisNameBorderAlpha:c.yaxisnameborderalpha,axisNameBorderPadding:c.yaxisnameborderpadding,axisNameBorderRadius:c.yaxisnameborderradius,axisNameBorderThickness:c.yaxisnameborderthickness,axisNameBorderDashed:c.yaxisnameborderdashed,axisNameBorderDashLen:c.yaxisnameborderdashlen,axisNameBorderDashGap:c.yaxisnameborderdashgap,axisNameWidth:c.yaxisnamewidth,useEllipsesWhenOverflow:c.useellipseswhenoverflow,rotateAxisName:pluckNumber(c.rotateyaxisname,1),axisName:c.yaxisname,divLineColor:pluck(c.divlinecolor,a.getColor(e.divLineColor)),divLineAlpha:pluck(c.divlinealpha,d?a.getColor('divLineAlpha3D'):a.getColor('divLineAlpha')),divLineThickness:pluckNumber(c.divlinethickness,1),divLineIsDashed:!!pluckNumber(c.divlinedashed,c.divlineisdashed,0),divLineDashLen:pluckNumber(c.divlinedashlen,4),divLineDashGap:pluckNumber(c.divlinedashgap,2),showAlternateGridColor:pluckNumber(c.showalternatehgridcolor,1),alternateGridColor:pluck(c.alternatehgridcolor,a.getColor('altHGridColor')),alternateGridAlpha:pluck(c.alternatehgridalpha,a.getColor('altHGridAlpha')),numDivLines:pluckNumber(c.numdivlines,this.numDivLines),axisMinValue:c.yaxisminvalue,axisMaxValue:c.yaxismaxvalue,setAdaptiveMin:c.setadaptiveymin,adjustDiv:c.adjustdiv,labelStep:c.yaxisvaluesstep,showAxisValues:pluckNumber(c.showyaxisvalues,c.showyaxisvalue),showLimits:pluckNumber(c.showlimits,this.showLimits),showDivLineValues:pluckNumber(c.showdivlinevalues,c.showdivlinevalue),zeroPlaneColor:c.zeroplanecolor,zeroPlaneThickness:c.zeroplanethickness||2,zeroPlaneAlpha:c.zeroplanealpha,showZeroPlaneValue:c.showzeroplanevalue,trendlineColor:c.trendlinecolor,trendlineToolText:c.trendlinetooltext,trendlineThickness:c.trendlinethickness,trendlineAlpha:c.trendlinealpha,showTrendlinesOnTop:c.showtrendlinesontop,showAxisLine:pluckNumber(c.showyaxisline,c.showaxislines,c.drawAxisLines,0),axisLineThickness:pluckNumber(c.yaxislinethickness,c.axislinethickness,1),axisLineAlpha:pluckNumber(c.yaxislinealpha,c.axislinealpha,100),axisLineColor:pluck(c.yaxislinecolor,c.axislinecolor,'#000000')}]}}_resetViewPortConfig(){var a=this;a.config.viewPortConfig={scaleX:1,scaleY:1,x:0,y:0}}_setCategories(){var a=this.getFromEnv('dataSource'),b=this.getChildren('xAxis')[0],c=this.getChildren('yAxis')[0],d=a.categories,e=a.datatable,f=a.processes;c.setAxisPadding(.5,.5),c.setProcess(f),c.setDataTable(e),b.setCategory(d)}getDSdef(a){switch(a){case'milestone':return Milestone;case'connector':return Connector;case'task':default:return Task;}}_createLegendItems(){let a,b,c,d,e,f,g,h,j,k,l,m=this,n=m.getFromEnv('dataSource'),o=m.getFromEnv('legend'),p=o.getChildren('legendItem'),q=n.legend&&n.legend.item||[];if(this.config.legendItemIds||(this.config.legendItemIds=[]),j=p&&p.length||0,k=q.length,j>k){for(b=k;b<j;b++)o.disposeItem(p[b].getId());p&&p.splice(k,j-k)}for(b=0,a=q.length;b<a;b++)g=q[b],o.getItem(this.config.legendItemIds[b])?l=this.config.legendItemIds[b]:(l=o.createItem(),this.config.legendItemIds.push(l)),e=g.color,c=getLightColor(e,60).replace(dropHash,'#'),d=getLightColor(e,40),f={FCcolor:{color:e+','+e+','+d+','+e+','+e,ratio:'0,70,30',angle:270,alpha:'100,100,100,100,100'}},h={label:g.label,interactiveLegend:!1},o.getItem(l).configure(h),o.getItem(l).setStateCosmetics('default',{symbol:{fill:toRaphaelColor(f),stroke:toRaphaelColor(c)}})}_spaceManager(){let a,b,c,d,e,f,g=this.config,h=this.getChildren('xAxis')[0],i=this.getChildren('yAxis')[0],j=this.getChildren('legend')[0],k=g.ganttwidthpercent,l=g.borderWidth,m=0,n=0;this._resetViewPortConfig(),this._allocateSpace({top:l,bottom:l,left:l,right:l}),this._allocateSpace(this._manageActionBarSpace&&this._manageActionBarSpace(.225*g.availableHeight)||{}),j&&(c=j.config.legendPos),a=c===POSITION_BOTTOM?.6*g.canvasHeight:.6*g.canvasWidth,this._manageChartMenuBar(a),d='right'===c?.3*g.canvasWidth:.3*g.canvasHeight,g.showLegend&&this._manageLegendSpace(d),g.actualCanvasTop=g.canvasTop,g.actualCanvasLeft=g.canvasLeft,b=g.canvasWidth*((100-(k||67))/100),e=i.placeAxis(b),m+=(e.left||0)+(e.right||0),i&&this._allocateSpace(e),a=c===POSITION_BOTTOM?.6*g.canvasHeight:.6*g.canvasWidth,a=.6*g.canvasHeight,e=h.placeAxis(a),n+=e.top||0,g.totalWidth=m,g.totalHeight=n,h&&this._allocateSpace(e),f=i&&i.setProcessHeight(),i.setAxisConfig({processTotalHeight:f})}_postSpaceManagement(){var a,b,c,d,e,f,g,h,i,j=Math.max,k=this,l=k.config,m=k.linkedItems,n=this.getChildren('xAxis')[0],o=this.getChildren('yAxis')[0],p=o.getAxisConfig('processTotalHeight'),q=l.canvasHeight,r=this.getChildren('legend')[0],s=l.xDepth,t=this.getChildren('canvas')[0].config,u=t.canvasBorderWidth,v=t.canvasPadding,w=m.vScrollBar,x=w.config.userConf,y=t.canvasPaddingLeft,z=t.canvasPaddingRight,A=+l.ganttpaneduration,B=l.ganttpanedurationunit,C=m.hProcessScrollBar,D=m.hScrollBar,E=D&&D.config.userConf.height||0,F=C&&C.config.userConf.height||0;e=!(A===UNDEF||B===UNDEF),c=o.getAxisConfig('totalWidth'),d=o.getAxisConfig('totalVisiblelWidth'),f=!!(c>d),g=j(f?F:0,e?E:0),h=q-g,p>h&&(b=!0),a=b?x.width||0:0,i=l.canvasWidth-(s||0)-j(y,v)-j(z,v)-a,n&&n.setAxisDimention({x:t.canvasLeft+(s||0)+j(y,v),y:t.canvasTop-(l.shift||0),opposite:t.canvasTop+t.canvasHeight+u,axisLength:i}),l.currentCanvasWidth=i,o&&o.setAxisDimention({x:t.canvasLeft-(l.shift||0),y:t.canvasTop,opposite:t.canvasRight+u,axisLength:l.canvasHeight}),k._manageScrollerPosition(),l.showLegend&&r.postSpaceManager()}drawScrollBar(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=this,o=n.config,p=n.linkedItems,q=n.getChildren(),r=q.xAxis[0],s=r.config.axisRange,t=o.viewPortConfig,u=o.scrollOptions||(o.scrollOptions={}),v=s.max,w=s.min,x=u.horizontalVxLength,y=p.hScrollBar,z=y.node,A=p.vScrollBar,B=A.node,C=p.hProcessScrollBar,D=C.node,E=o.useverticalscrolling,F=o.canvasRight,G=t.scaleX,H=t.scaleY,I=o.vScrollEnabled,J=q.yAxis[0],K=I?A.config.conf.width:0,L=n.getContainer(),M=n.getChildContainer(),N=n.getFromEnv('animationManager');a=o.canvasLeft,b=o.canvasTop,c=o.canvasHeight,d=o.canvasWidth,e=q.canvas[0].config,u.viewPortMin=w,u.viewPortMax=v,u.scrollRatio=x/(v-w),i=u.windowedCanvasWidth=r.getPixel(x),j=u.fullCanvasWidth=r.getPixel(v-w)-i,h=u.fullCanvasHeight=J.getAxisConfig('processTotalHeight'),g=u.windowedCanvasHeight=c,k=J.getAxisConfig('totalWidth'),l=J.getAxisConfig('totalVisiblelWidth'),f=1/H,m=L.scrollBarParentGroup,m||(m=L.scrollBarParentGroup=N.setAnimation({el:'group',attr:{name:'scrollBarParentGroup'},container:L.parentgroup,component:n}),m.insertBefore(M.datalabelsGroup)),!1===o.hScrollEnabled?y&&y.config&&y.config.node&&y.config.node.hide():(y.draw(a,b+c,{width:d-K,scrollRatio:1/G,scrollPosition:t.x*G/(d*(G-1)),roundEdges:e.isRoundEdges,fullCanvasWidth:j,windowedCanvasWidth:i,parentLayer:m}),!z&&function(){var a;R.eve.on('raphael.scroll.start.'+y.config.node.id,function(b){a=b,n.fireChartInstanceEvent('scrollstart',{scrollPosition:b})}),R.eve.on('raphael.scroll.end.'+y.config.node.id,function(b){n.fireChartInstanceEvent('scrollend',{prevScrollPosition:a,scrollPosition:b})})}()),!1!==I&&E?(A.draw(F-K,b,{height:c,scrollRatio:f,roundEdges:e.isRoundEdges,fullCanvasWidth:h,windowedCanvasWidth:g,parentLayer:m}),!B&&function(){var a;R.eve.on('raphael.scroll.start.'+A.config.node.id,function(b){a=b,n.fireChartInstanceEvent('scrollstart',{scrollPosition:b})}),R.eve.on('raphael.scroll.end.'+A.config.node.id,function(b){n.fireChartInstanceEvent('scrollend',{prevScrollPosition:a,scrollPosition:b})})}()):A&&A.config&&A.config.node&&A.config.node.hide(),l<k&&0<l?(C.draw(a-l,b+c,{width:l,scrollRatio:l/k,roundEdges:e.isRoundEdges,fullCanvasWidth:j,windowedCanvasWidth:i,parentLayer:m}),!D&&function(){var a;R.eve.on('raphael.scroll.start.'+C.config.node.id,function(b){a=b,n.fireChartInstanceEvent('scrollstart',{scrollPosition:b})}),R.eve.on('raphael.scroll.end.'+C.config.node.id,function(b){n.fireChartInstanceEvent('scrollend',{prevScrollPosition:a,scrollPosition:b})})}()):C&&C.config&&C.config.node&&C.config.node.hide()}_setAxisScale(){var a,b,c,d,e,f,g,h,i,j=this,k=j.getChildren(),l=j.config,m=k.xAxis[0],n=m.getLimit(),o=n.max,p=n.min,q=new Date(p),r=k.yAxis[0],s=j.getFromEnv('number-formatter'),t=+l.ganttpaneduration,u=l.scrollOptions||(l.scrollOptions={}),v=l.ganttpanedurationunit,w=l.canvasHeight,x=l.scrolltodate,y=l.canvasWidth,z=l.canvasLeft,A=j.linkedItems.hProcessScrollBar,B=j.linkedItems.hScrollBar,C=B&&B.config&&B.config.userConf.height||0,D=A&&A.config&&A.config.userConf.height||0,E=m.getPixel(o)-z,F=r.getAxisConfig('processTotalHeight');if(t===UNDEF||v===UNDEF)l.hScrollEnabled=!1;else{switch(v){case'y':q.setFullYear(q.getFullYear()+t);break;case'm':q.setMonth(q.getMonth()+t);break;case'd':q.setDate(q.getDate()+t);break;case'h':q.setHours(q.getHours()+t);break;case'mn':q.setMinutes(q.getMinutes()+t);break;default:q.setSeconds(q.getSeconds()+t);}q=q.getTime(),h=m.getPixel(q)-z,l.hScrollEnabled=!0,l.viewPortConfig.scaleX=a=E/h,u.horizontalVxLength=(o-p)/i*t,x&&(b=s.getDateValue(x).ms,d=m.getPixel(b),l.viewPortConfig.x=mathMin(d-z,y*(a-1))/a)}f=r.getAxisConfig('totalWidth'),e=r.getAxisConfig('totalVisiblelWidth'),l.hProcessScrollEnabled=!!(f>e),c=mathMax(l.hProcessScrollEnabled?D:0,l.hScrollEnabled?C:0),g=w-c,Math.floor(F)>g?(l.viewPortConfig.scaleY=F/g,l.vScrollEnabled=!0):l.vScrollEnabled=!1}_createToolBoxGantt(){var a,b,c,d,e,f,g=this,h=g.linkedItems=g.linkedItems||{},i=g.getChildren(),j=i.yAxis[0],k=g._scrollBar,l=i.chartMenuBar||{},m=i.actionBar,n=k.get,o=k.add,p=g.getFromEnv('chartInstance').id;l.drawn||m&&m.drawn||(a=i.tb[0],f=g.getFromEnv('toolBoxAPI'),b=f.Scroller,k.clear(),o({isHorizontal:!0},{scroll:function(a,b){return function(){a.updateManagerH(arguments[0],b)}}(g,!0)}),o({isHorizontal:!1},{scroll:function(a,b){return function(){a.updateManagerV(arguments[0],b)}}(g,!1)}),o({isHorizontal:!0},{scroll:function(){return function(){j.manageProcessScroll(arguments[0])}}(g,!0)}),c=n()[0],e=n()[1],d=n()[2],!h.hScrollBar&&(h.hScrollBar=new b,h.hScrollBar.configure(c.conf,1,a.pId,p),h.hScrollBar.attachEventHandlers(c.handler)),!h.vScrollBar&&(h.vScrollBar=new b,h.vScrollBar.configure(e.conf,2,a.pId,p),h.vScrollBar.attachEventHandlers(e.handler)),!h.hProcessScrollBar&&(h.hProcessScrollBar=new b,h.hProcessScrollBar.configure(d.conf,3,a.pId,p),h.hProcessScrollBar.attachEventHandlers(d.handler)))}_manageScrollerPosition(){var a,b,c,d=this,e=d.config,f=d.linkedItems,g=f.hScrollBar,h=f.vScrollBar,i=f.hProcessScrollBar,j=e.totalWidth||0,k=e.totalHeight||0;d._setAxisScale&&d._setAxisScale(),b=e.vScrollEnabled,a=e.hScrollEnabled,c=g.getLogicalSpace(),e.hScrollHeight=!1===a?0:c.height+h.config.conf.padding,c=h.getLogicalSpace(),e.vScrollWidth=!1===b?0:c.width+h.config.conf.padding,c=i.getLogicalSpace(),e.hProcessScrollHeight=e.hProcessScrollEnabled?c.height+i.config.conf.padding:0,k+=mathMax(e.hProcessScrollHeight,e.hScrollHeight),d._allocateSpace({bottom:mathMax(e.hProcessScrollHeight,e.hScrollHeight)}),e.totalWidth=j,e.totalHeight=k}updateManagerH(a){var b,c=this,d=c.config,e=d.lastXpos||(d.lastXpos={x:0,y:0}),f=c.config.viewPortConfig,g=c.getFromEnv('animationManager'),h=f.scaleX,i=c.getChildren(),j=i.xAxis[0],k=c.getChildContainer(),l=k.plotGroup,m=c.getChildContainer('datalabelsGroup'),n=k.datalabelsGroup,o=k.trackerGroup,p=d.xOffset||0,q=d.yOffset||0,r=d.currentCanvasWidth,s=j.getContainer('ganttPlotLineContainer');p=d.xOffset=r*(h-1)*a,f.x=p/h,j.translateAxis(-p,void 0),e.x=-p,b='t'+-p+', '+-q,g.setAnimation({el:l,attr:{transform:b},component:c}),g.setAnimation({el:n,attr:{transform:b},component:c}),g.setAnimation({el:o,attr:{transform:b},component:c}),g.setAnimation({el:m,attr:{transform:b},component:c}),g.setAnimation({el:s,attr:{transform:'t'+-p+', '+0},component:c})}updateManagerV(a){var b,c=this,d=c.config,e=c.getFromEnv('animationManager'),f=d.lastXpos||(d.lastXpos={x:0,y:0}),g=c.config.viewPortConfig,h=c.getChildren(),i=h.yAxis[0],j=d.yOffset||0,k=d.canvasHeight,l=g.scaleY,m=c.getChildContainer('datalabelsGroup'),n=i.getContainer('labelContainer'),o=c.getChildContainer('plotGroup'),p=i.getContainer('ganttPlotHoverBandContainer'),q=i.getContainer('ganttPlotLineContainer');j=d.yOffset=k*(l-1)*a,g.y=j/l,b=i.config.lastTranslate||(i.config.lastTranslate={x:0,y:0}),e.setAnimation({el:n,attr:{transform:'t'+b.x+', '+-j},component:c}),e.setAnimation({el:p,attr:{transform:'t0, '+-j},component:c}),e.setAnimation({el:o,attr:{transform:'t'+f.x+', '+-j},component:c}),e.setAnimation({el:m,attr:{transform:'t'+f.x+', '+-j},component:c}),e.setAnimation({el:q,attr:{transform:'t0, '+-j},component:c})}}export default Gantt;