import{pluckNumber,toPrecision,getFirstValue,pluck}from'./utils';import AnnotationShape from'./annotation-shape';const STRAIGHT_ANGLE_DEGREES=180,FULL_ANGLE_DEGREES=360,DEFAULT_RADIUS_INNER=0,DEFAULT_ANGLE_START=0,DEFAULT_ANGLE_END=360,DEFAULT_PAPER_WIDTH=700,DEFAULT_PAPER_HEIGHT=350,isPerfectCircle=a=>a.startAngle===DEFAULT_ANGLE_START&&a.endAngle===DEFAULT_ANGLE_END,circleHasHole=a=>0<a.innerRadius||0<a.innerYRadius;function toRadian(a){return a*(Math.PI/STRAIGHT_ANGLE_DEGREES)}class CircleAnnotation extends AnnotationShape{_configureShape(a){let b=this,c=b._getFromStore('paper'),d=c&&c.width||DEFAULT_PAPER_WIDTH,e=c&&c.height||DEFAULT_PAPER_HEIGHT,f=Math.max(d,e),g=Math.sqrt(f);b.config.radius=a.radius,b.config.xRadius=pluckNumber(parseFloat(a.radius),parseFloat(a.xRadius),g),b.config.yRadius=pluckNumber(parseFloat(a.yRadius),b.config.xRadius),b.config.startAngle=pluckNumber(parseFloat(a.startAngle),DEFAULT_ANGLE_START),b.config.endAngle=pluckNumber(parseFloat(a.endAngle),DEFAULT_ANGLE_END),b.config.innerRadius=pluckNumber(parseFloat(a.innerRadius),DEFAULT_RADIUS_INNER),b.config.innerYRadius=pluckNumber(parseFloat(a.innerYRadius),b.config.innerRadius,DEFAULT_RADIUS_INNER),b.config.elementType='arc'===b.config.type?'ringpath':isPerfectCircle(b.config)&&!circleHasHole(b.config)?'ellipse':'ringpath'}_getExtraEditableRequests(){let a=this,b=[{name:'radius',value:toPrecision(a.config.xRadius,2)},{name:'startAngle',value:a.config.startAngle},{name:'endAngle',value:a.config.endAngle},{name:'fillColor',value:a.config.rawColor},{name:'fillAlpha',value:a.config.rawAlpha},{name:'fillRatio',value:getFirstValue(a.config.rawRatio,'')},{name:'fillAngle',value:a.config.rawAngle},{name:'fillPattern',value:'radial'===a.config.rawFillPattern},{name:'showBorder',value:1===a.config.showBorder},{name:'borderColor',value:a.config.rawBorderColor},{name:'borderThickness',value:a.config.borderThickness},{name:'borderAlpha',value:a.config.rawBorderAlpha}];return'arc'===a.config.type&&b.push({name:'innerRadius',value:a.config.innerRadius}),b}updateAttr(a){let b,c,d=this,e=this.config,f=d._getFromStore('paper'),g=d.getScaledVal(e.xRadius),h=d.getScaledVal(e.yRadius),i=d.getScaledVal(e.innerRadius),j=d.getScaledVal(e.innerYRadius);switch(pluck(e.radius)||(e.radius=f.width<f.height?d.getScaledVal(f.width):d.getScaledVal(f.height),e.radius*=.3,i>e.radius&&(i+=e.radius,e.radius=i-e.radius,i-=e.radius),g=h=e.radius,j=i),e.elementType){case'ringpath':c=[pluckNumber(a.x,d.getScaledVal(e.x,!0)),pluckNumber(a.y,d.getScaledVal(e.y,!1)),g,i,toRadian(FULL_ANGLE_DEGREES-e.endAngle),toRadian(FULL_ANGLE_DEGREES-e.startAngle),h,j],b={ringpath:c};break;default:b={cx:pluckNumber(a.x,d.getScaledVal(e.x,!0)),cy:pluckNumber(a.y,d.getScaledVal(e.y,!1))};}d._setConfig('attr',b)}_getAnnotationAttrs(){let a,b=this,c=b.config,d=b._getConfig('attr')||{},e=c.x,f=c.y,g=b.getScaledVal(c.xRadius),h=b.getScaledVal(c.yRadius),i=b.getScaledVal(c.innerRadius),j=b.getScaledVal(c.innerYRadius),k=c.startAngle,l=c.endAngle,m=c.borderColor,n=c.borderThickness,o=c.dashArrayStr,p=c.color;switch(c.xRadius||(g=0),c.yRadius||(h=0),d.fill=p,d.stroke=m,d['stroke-width']=n,d['stroke-dasharray']=o,b.config.elementType){case'ringpath':a=[b.getScaledVal(e,!0),b.getScaledVal(f,!1),g,i,toRadian(FULL_ANGLE_DEGREES-l),toRadian(FULL_ANGLE_DEGREES-k),h,j],d.ringpath=d.ringpath||a;break;default:d.rx=g,d.ry=h,d.cx='undefined'==typeof d.cx?b.getScaledVal(e,!0):d.cx,d.cy='undefined'==typeof d.cy?b.getScaledVal(f,!1):d.cy;}return d}}export default CircleAnnotation;