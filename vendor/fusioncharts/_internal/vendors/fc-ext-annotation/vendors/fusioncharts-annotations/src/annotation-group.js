import{pluckNumber,pluckBoolean,pluck,pluckFontSize}from'./utils';import AnnotationBaseShape from'./annotation-base';import mergeDeepRight from'ramda/src/mergeDeepRight';const DEFAULT_IS_VISIBLE=!0,DEFAULT_OPACITY=100,DEFAULT_COLOR='#FF0000',DEFAULT_SHOW_SHADOW=0,DEFAULT_POSITION=0;class AnnotationGroup extends AnnotationBaseShape{constructor(a={}){super(a),this.groups=[],this.items=[]}setAttribute(a){var b=this,c={},d=b.config;c=mergeDeepRight(b.rawConfig,a),b.rawConfig=c,d.id=b.rawConfig.id||b.getId('group'),d.autoScale=pluckNumber(b.rawConfig.autoScale,1),d.scaleText=pluckNumber(b.rawConfig.scaleText,0),d.scaleX=d.origScaleX=pluckNumber(b.rawConfig.xScale)/100,d.scaleY=d.origScaleY=pluckNumber(b.rawConfig.yScale)/100,d.scaleImages=pluckNumber(b.rawConfig.scaleImages,0),d.constrainedScale=pluckNumber(b.rawConfig.constrainedScale,1),d.origH=+b.rawConfig.origH,d.origW=+b.rawConfig.origW,d.link=b.rawConfig.link,d.color=b.rawConfig.color||DEFAULT_COLOR,d.alpha=pluckNumber(parseFloat(b.rawConfig.alpha),DEFAULT_OPACITY),d.showShadow=pluckNumber(b.rawConfig.showShadow,DEFAULT_SHOW_SHADOW),d.x=pluckNumber(b.rawConfig.x,b.rawConfig.xPos,DEFAULT_POSITION),d.y=pluckNumber(b.rawConfig.y,b.rawConfig.yPos,DEFAULT_POSITION),d.font=pluck(b.rawConfig.font,'Verdana, sans'),d.fontSize=pluckFontSize(b.rawConfig.fontSize,10),d.textAlign=pluck(b.rawConfig.textAlign),d.textVAlign=pluck(b.rawConfig.textVAlign),d.rotateText=pluck(b.rawConfig.rotateText),d.wrapText=pluck(b.rawConfig.wrapText),d.grpXShift=pluckNumber(b.rawConfig.grpXShift,0),d.grpYShift=pluckNumber(b.rawConfig.grpYShift,0),d.xShift=pluckNumber(b.rawConfig.xShift,0),d.yShift=pluckNumber(b.rawConfig.yShift,0),d.toolText=b.rawConfig.toolText,d.isVisible=pluckBoolean(b.rawConfig.isVisible,DEFAULT_IS_VISIBLE),d.elementType='group'}updateScale(){var a=Math.min;let b,c,d,e,f,g=this,h=g._getConfig('origScaleX'),i=g._getConfig('origScaleY'),j=g._getFromStore('paper'),k=j.height,l=j.width,m=g._getConfig('autoScale'),n=g._getConfig('constrainedScale');g._setConfig('origW',+g._getConfig('origW')||l),g._setConfig('origH',+g._getConfig('origH')||k),m?(c=l/g._getConfig('origW')*(+h||1),d=k/g._getConfig('origH')*(+i||1)):c=d=1,b=a(c,d),g._setConfig('scaleValue',b),(0<m||isNaN(g._getConfig('scaleX')))&&(e=n?b:c,g._setConfig('scaleX',e)),(0<m||isNaN(g._getConfig('scaleY')))&&(f=n?b:d,g._setConfig('scaleY',f)),g._setConfig('scaleFont',g._getConfig('scaleText')?a(g._getConfig('scaleX'),g._getConfig('scaleY')):1),g._setConfig('scaleImageX',g._getConfig('scaleImages')?g._getConfig('scaleX'):1),g._setConfig('scaleImageY',g._getConfig('scaleImages')?g._getConfig('scaleY'):1)}updateAttr(a){let b,c,d,e=this,f=e.config;for(b in a)a[b]&&(f[b]=a[b]);c=e.getScaledVal(e._getConfig('grpXShift'))+e._getConfig('xShift'),d=e.getScaledVal(e._getConfig('grpYShift'))+e._getConfig('yShift'),e._setConfig('attr',{transform:`T${c},${d}`})}attachItem(a){this.items.push(a),a._setToStore('annotation-group',this),a.groupConfig={},a._setGroupElement(this._getFromStore('element'))}retrieveItem(a){return find.call(this.items,b=>b.getId()===a)}getScaledVal(a,b){let c,d=this;return d?(c=b?d._getConfig('scaleX'):(!1===b?d._getConfig('scaleY'):d._getConfig('scaleValue'))||1,a*c):a}getScaledFont(a){let b=this;return b?a*b._getConfig('scaleFont'):a}getScaledImageVal(a,b){let c,d=this;return d?(c=(b?d._getConfig('scaleImageX'):d._getConfig('scaleImageY'))||1,a*c):a}_draw(){var a,b,c=this,d=c._getGroupElement(),e=this._getFromStore('element'),f=c._getConfig('attr')||{},g=c._getFromStore('animationManager');a=c.getScaledVal(c._getConfig('grpXShift'))+c._getConfig('xShift'),b=c.getScaledVal(c._getConfig('grpYShift'))+c._getConfig('yShift'),f.name=c._getConfig('id'),f.transform=f.transform||`T${a},${b}`,e=g.setAnimation({el:e||'group',attr:f,container:d,component:c._getFromStore('component'),dom:'group'}),c._getConfig('isVisible')?e.show():e.hide(),c._setToStore('element',e)}dispose(){let a,b,c,d,e=this._getFromStore('controller'),f=e.retrieveGroup(this.getId(),!0),g=f.items||[];for(d=0;d<g.length;d++)c=e.retrieveItem(g[d].getId(),!0),c&&c.dispose();a=f._getFromStore('animationManager'),b=f._getFromStore('element'),b&&a.setAnimation({el:b,component:f._getFromStore('component')})}}export default AnnotationGroup;