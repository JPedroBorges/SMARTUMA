import{pluck,pluckNumber,trim}from'./utils';import AnnotationShape from'./annotation-shape';function getCharacterType(a){return'9'>=a&&'0'<=a||'-'===a||'.'===a?0:'z'>=a&&'a'<=a||'Z'>=a&&'A'<=a?1:2}class PathAnnotation extends AnnotationShape{_configureShape(a){let b=this;b.config.pathStr=pluck(a.path),b.config.x=pluckNumber(a.x,0),b.config.y=pluckNumber(a.y,0),b.config.tox=pluckNumber(a.toX,b.config.x),b.config.toy=pluckNumber(a.toY,b.config.y),b.config.elementType='path'}getExtraEditableRequests(){let a=this,b=[{name:'thickness',value:a.config.borderThickness},{name:'color',value:a.config.rawColor},{name:'alpha',value:a.config.rawAlpha}];return b}getScaledPath(){let a,b,c,d,e,f=this,g=f.config.pathStr,h=[],k='';for(e=g&&g.length,c=0;c<e;c++){for(d=c,b='',a=getCharacterType(g[c]);d<e&&getCharacterType(g[d])===a;)b+=g[d],d++;b=trim(b),''!==b&&2>a&&h.push(b),c=d===c?d:d-1}for(e=h.length,c=0;c<e;)switch(k+=h[c],h[c].toLowerCase()){case'm':case'l':case't':k+=f.getScaledVal(+h[c+1],!0).toString()+',',k+=f.getScaledVal(+h[c+2],!1).toString(),c+=3;break;case's':case'q':k+=f.getScaledVal(+h[c+1],!0).toString()+',',k+=f.getScaledVal(+h[c+2],!1).toString()+',',k+=f.getScaledVal(+h[c+3],!0).toString()+',',k+=f.getScaledVal(+h[c+4],!1).toString(),c+=5;break;case'h':k+=f.getScaledVal(+h[c+1],!0).toString(),c+=2;break;case'v':k+=f.getScaledVal(+h[c+1],!1).toString(),c+=2;break;case'c':k+=f.getScaledVal(+h[c+1],!0).toString()+',',k+=f.getScaledVal(+h[c+2],!1).toString()+',',k+=f.getScaledVal(+h[c+3],!0).toString()+',',k+=f.getScaledVal(+h[c+4],!1).toString()+',',k+=f.getScaledVal(+h[c+5],!0).toString()+',',k+=f.getScaledVal(+h[c+6],!1).toString(),c+=7;break;case'a':k+=f.getScaledVal(+h[c+1],!0).toString()+',',k+=f.getScaledVal(+h[c+2],!1).toString()+',',k+=f.getScaledVal(+h[c+3],!0).toString()+',',k+=h[c+4]+',',k+=h[c+5]+',',k+=f.getScaledVal(+h[c+6],!0).toString()+',',k+=f.getScaledVal(+h[c+7],!1).toString(),c+=8;break;case'z':default:c++;}return k.toString()}updateAttr(a){let b,c,d,e,f=this,g=f.config,h={};b=pluckNumber(a.x,f.getScaledVal(g.x,!0)),c=pluckNumber(a.y,f.getScaledVal(g.y,!1)),d=pluckNumber(a.toX,b,f.getScaledVal(g.tox,!0)),e=pluckNumber(a.toY,c,f.getScaledVal(g.toy,!1)),g.pathStr?(h.path=f.getScaledPath(),h.transform=`T${b},${c}`):h.path=`M${b},${c}L${d},${e}`,f._setConfig('attr',h)}_getAnnotationAttrs(){let a,b,c,d,e,f=this,g=f.config,h=f._getConfig('attr')||{},i=g.borderThickness,j=g.dashArrayStr,k=g.color;return(h.stroke=k,f.rawConfig.color&&(h.fill=k),h['stroke-width']=f.getScaledVal(i),h['stroke-dasharray']=j,a=h.x||f.getScaledVal(g.x,!0),b=h.y||f.getScaledVal(g.y,!1),c=h.toX||f.getScaledVal(g.tox,!0),d=h.toY||f.getScaledVal(g.toy,!1),h.path)?h:(e=f.getScaledPath(),e?(h.path=e,h.transform=h.transform||`T${a},${b}`):h.path=h.path||`M${a},${b}L${c},${d}`,h)}}export default PathAnnotation;