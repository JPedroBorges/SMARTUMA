import AnnotationInterface from'./annotation-interface';import{addListener,removeListener,triggerEvent,getListeners}from'./event-manager';const touchEnabled='ontouchstart'in window.document,nav=window.navigator,hasTouch=touchEnabled&&!(nav.maxTouchPoints||nav.msMaxTouchPoints),interActiveEvtList={click:!0,dragstart:!0,dragmove:!0,dragend:!0,dblclick:!0,mousedown:!0,mousemove:!0,mouseout:!0,mouseover:!0,mouseup:!0,"fc-click":!0,"fc-dragstart":!0,"fc-dragmove":!0,"fc-dragend":!0,"fc-dbclick":!0,"fc-mousedown":!0,"fc-mousemove":!0,"fc-mouseout":!0,"fc-mouseover":!0,"fc-mouseup":!0,"fc-pinchstart":touchEnabled||hasTouch,"fc-pinchmove":touchEnabled||hasTouch,"fc-pinchend":touchEnabled||hasTouch,touchstart:touchEnabled||hasTouch,touchmove:touchEnabled||hasTouch,touchend:touchEnabled||hasTouch,touchcancel:touchEnabled||hasTouch};let counter=0;function isInterActiveEvt(a){return!!interActiveEvtList[a]}function _mapSubFnForward(a,b){if(a&&a.hasOwnProperty&&b&&b.call){let c,d,e,f;for(c in a)if(a.hasOwnProperty(c))if(d=a[c],d instanceof Array)for(f=d.length,e=0;e<f;e++)b(d[e],c,e);else b(d,c)}}function addEventOnAllGraphics(a,b,c){var d;b&&c&&(d=a=>{a.on&&a.on(b,c)},a.getGraphicalElement&&_mapSubFnForward(a.getGraphicalElement(),d),a.getChildContainer&&_mapSubFnForward(a.getChildContainer(),d))}function removeEventFromAllGraphics(a,b,c){var d;b&&c&&(d=a=>{a.off&&a.off(b,c)},_mapSubFnForward(a.getGraphicalElement(),d),_mapSubFnForward(a.getChildContainer(),d))}class AnnotationBaseShape extends AnnotationInterface{constructor(a={}){super(a),counter++}setEditor(a){this.store.editor=a}_setGroupElement(a){this.store.groupElement=a}_getGroupElement(){return this.store.groupElement}getId(a){return this.config.id||`annotation_${a}_${counter}`}getGraphicalElement(){let a={};return a[this.getId()]=this._getFromStore('element'),a}getElement(){return this._getFromStore('element')}getBounds(){return this.getElement().getBBox()}addEventListener(a,b){let c,d=this;return!!(a&&a.toLowerCase&&(a=a.toLowerCase(),addListener(a,b,d)))&&(isInterActiveEvt(a)&&(c=getListeners(a,d),c&&1===c.length&&(!d._middleListeners&&(d._middleListeners={}),!d._middleListeners[a]&&(d._middleListeners[a]=function(b){d.fireEvent(a,void 0,void 0,void 0,b)}),addEventOnAllGraphics(d,a,d._middleListeners[a]))),b)}removeEventListener(a,b){let c,d=this;a&&a.toLowerCase&&(a=a.toLowerCase(),removeListener(a,b,this),isInterActiveEvt(a)&&(c=getListeners(a,this),c&&0===c.length&&this._middleListeners&&this._middleListeners[a]&&removeEventFromAllGraphics(d,a,this._middleListeners[a])))}fireEvent(a,b,c,d,e){triggerEvent(a,this,b,e,c,d)}}export default AnnotationBaseShape;