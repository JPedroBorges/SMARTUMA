import{pluck,pluckNumber,extend2}from'../lib/lib';export default function(b){const a=/rgba\([\d]+\,[\d]+\,[\d]+\,0\)$/;var c,d=window,e=d.navigator.userAgent,f='createTouch'in d.document,g=/msie/i.test(e)&&!d.opera,h=Math,j=h.cos,k=h.sin,i=h.abs,l=h.min,m=h.PI,n=d.parseInt,p=d.parseFloat,q=String,r=Array.prototype.slice,s='rgba(192,192,192,'+(g?.002:1e-6)+')',t=b.eve,u=/\s*\,\s*/g;b&&b._availableAnimAttrs&&b._availableAnimAttrs.cx&&(b._availableAnimAttrs['scroll-position']=b._availableAnimAttrs.cx),b.define&&b.define([{name:'polypath',polypath:function(){return this.path(c,b._lastArgIfGroup(arguments))},ca:{polypath:function(a,c,d,e,f,g){var l,o,q,s,t;if(l=[],a=n(a,10)||0,c=p(c)||0,d=p(d)||0,e=p(e)||0,f=null===f||isNaN(f)?.5*m:b.rad(f),g=null===g||isNaN(g)?0:p(g),s=f,2<a)switch(o=2*m/a,g){case 0:for(q=0;q<a;q++)l.push('L',c+e*j(-s),d+e*k(-s)),s+=o;l[0]='M',l.push('Z');break;case 1:for(q=0;q<a;q++)l.push('M',c,d,'L',c+e*j(-s),d+e*k(-s)),s+=o;break;default:for(o*=.5,t=e*j(o)*(1-g),q=0;q<a;q++)l.push('L',c+e*j(-s),d+e*k(-s)),s+=o,l.push('L',c+t*j(-s),d+t*k(-s)),s+=o;l[0]='M',l.push('Z');}else 0===e?l.push('M',c,d,'L',c,d,'Z'):l.push('M',c-e,d,'A',e,e,0,0,0,c+e,d,'A',e,e,0,0,0,c-e,d,'Z');return{path:l}},r:function(a){var b=this,c=b.attrs.polypath;return c[3]=a,b.attr('polypath',c),!1}}},{name:'scroller',scroller:function(c,d,e,f,g,j,k){'object'==typeof c&&c.scroller&&([c,d,e,f,g,j,k]=c.scroller);var l,m,n,q,r,s=this,u=s.group('scroller',k),o=u.attrs,v=u._.scroller={},z={};for(r in l=g&&'horizontal'||'vertical',v.track=s.rect(u).on('fc-mousedown',v._mousedownTrack=function(a){var c,d,e=o['scroll-orientation'],f=o['scroll-position'],g=extend2({},v.anchor.node.getBoundingClientRect());g.y=g.y||g.top,g.x=g.x||g.left,g.height=g.height||g.bottom-g.top,g.width=g.width||g.right-g.left,d='horizontal'===e?a.x-(g.x+g.width/2):a.y-(g.y+g.height/2),c=d/v.trackLength,c=f+c,1<c?c=1:(0>c||isNaN(c))&&(c=0),m=b.animation({"scroll-position":c},2e3*i(f-c),'easeIn'),u.animate(m),t('raphael.scroll.start.'+u.id,u,f)}).on('fc-mouseup',v._mouseupTrack=function(){this.stop(m),t('raphael.scroll.end.'+this.id,this,o['scroll-position'])},u,!0),v.anchor=s.rect(u).drag(function(a){z['scroll-position']=n+a.data[q]/v.trackLength,1<=z['scroll-position']?z['scroll-position']=1:(0>=z['scroll-position']||isNaN(z['scroll-position']))&&(z['scroll-position']=0),u.attr(z)},function(){q='horizontal'===o['scroll-orientation']?0:1,t('raphael.scroll.start.'+u.id,u,n=o['scroll-position']),'function'==typeof v.scrollStart&&v.scrollStart.call(u,n)},function(){t('raphael.scroll.end.'+u.id,u,n=o['scroll-position']),'function'==typeof v.scrollEnd&&v.scrollEnd.call(u,n)}),b.fn.scroller.fn)u[r]=b.fn.scroller.fn[r];for(r in b.fn.scroller.ca)u.ca[r]=b.fn.scroller.ca[r];return o['scroll-orientation']=l,o['stroke-width']=1,u.ca['scroll-repaint']=u.ca['scroll-repaint-'+l],b.is(j,'object')||(j={}),u.attr({"scroll-display-buttons":j.showButtons&&'arrow'||'none',"scroll-display-style":j.displayStyleFlat&&'flat'||'3d',"scroll-ratio":p(j.scrollRatio)||1,"scroll-position":p(j.scrollPosition)||0,"scroll-repaint":[c,d,e,f]})},fn:{scroll:function(a){var b=this,c=b._.scroller;return c.callback=a.scroll,c.scrollStart=a.scrollStart,c.scrollEnd=a.scrollEnd,b},remove:function(){var a,c=this,d=c._.scroller;for(a in c.attr('scroll-display-buttons','none'),d.track.off('fc-mouseup',d._mouseupTrack),d.track.off('fc-mousedown',d._mousedownTrack),d)d[a]&&d[a].remove&&d[a].remove(),d[a]=null;delete c._.scroller,b.el.remove.apply(c,arguments)}},ca:{"stroke-width":function(a){var b=this,c=b._.scroller,d=pluckNumber(a['stroke-width'],1);return c.anchor.attr({"stroke-width":d}),c.track.attr({"stroke-width":d}),!1},"drop-shadow":function(a,b,c,d,e,f){return this._.scroller.track.attr('drop-shadow',[a,b,c,d,e,f]),!1},"scroll-display-style":function(a){var b=this,c=b.attrs,d=c['scroll-display-style'],e=c.fill;return a={flat:'flat',"3d":'3d',transparent:'transparent'}[a]||d,e&&a!==d&&(c['scroll-display-style']=a,b.attr('fill',e)),{"scroll-display-style":a}},"scroll-display-buttons":function(a){var d,e,f=this,g=f.paper,h=f._.scroller,i=f.attrs,j=i['scroll-display-buttons'],k=i['scroll-repaint'];return j===c&&(j='none'),a={none:'none',arrow:'arrow'}[a]||j,a!==j&&(i['scroll-display-buttons']=a,'none'===a&&h.start?(h.arrowstart.remove(),delete h.arrowstart,h.arrowend.remove(),delete h.arrowend,h.start.off('fc-mouseup',h._mouseupStart),h.start.off('fc-mousedown',h._mousedownStart),h.start.remove(),delete h.start,h.end.off('fc-mouseup',h._mouseupEnd),h.end.off('fc-mousedown',h._mousedownEnd),h.end.remove(),delete h.end):(h.arrowstart=g.polypath(f),h.arrowend=g.polypath(f),h.start=g.rect(f).on('fc-mousedown',h._mousedownStart=function(){var a,e,g,j=()=>{g=!0,e&&h.scrollEnd&&h.scrollEnd.call(f,f.attrs['scroll-position'])},k=()=>{e=!0,g&&h.scrollEnd&&h.scrollEnd.call(f,f.attrs['scroll-position'])};0===(a=i['scroll-position'])||(h.scrollStart&&h.scrollStart.call(f,f.attrs['scroll-position']),f.animate({"scroll-position":a-.1},100,c,j).animate(d=b.animation({"scroll-position":0},4500*a,'easeIn',k)),t('raphael.scroll.start.'+f.id,f,a))}).on('fc-mouseup',h._mouseupStart=function(){f.stop(d,!0),t('raphael.scroll.end.'+f.id,f,i['scroll-position'])},f),h.end=g.rect(f).on('fc-mousedown',h._mousedownEnd=function(){var a,d,g,j=()=>{g=!0,d&&h.scrollEnd&&h.scrollEnd.call(f,f.attrs['scroll-position'])},k=()=>{d=!0,g&&h.scrollEnd&&h.scrollEnd.call(f,f.attrs['scroll-position'])};1===(a=i['scroll-position'])||(h.scrollStart&&h.scrollStart.call(f,f.attrs['scroll-position']),f.animate({"scroll-position":a+.1},100,c,j).animate(e=b.animation({"scroll-position":1},4500*(1-a),'easeIn',k)),t('raphael.scroll.start.'+f.id,f,a))}).on('fc-mouseup',h._mouseupEnd=function(){f.stop(e,!0),t('raphael.scroll.end.'+f.id,f,i['scroll-position'])},f),i.fill&&f.attr('fill',i.fill)),k&&f.attr('scroll-repaint',k)),{"scroll-display-buttons":a}},"scroll-orientation":function(a){var b=this,c=b.attrs,d=c['scroll-repaint'],e=c['scroll-orientation'];return a={horizontal:'horizontal',vertical:'vertical'}[a]||e,e!==a&&(b.ca['scroll-repaint']=b.ca['scroll-repaint-'+a],d&&(d[2]+=d[3],d[3]=d[2]-d[3],d[2]-=d[3],b.attr('scroll-repaint',d)),c.fill&&b.attr('fill',c.fill)),{"scroll-orientation":a}},"scroll-ratio":function(a){var b=this,c=b.attrs,d=c['scroll-ratio'],e=c['scroll-repaint'];return a=1<a?1:.01>a?.01:p(a),e&&a!==d&&(c['scroll-ratio']=a,b.attr('scroll-repaint',e)),{"scroll-ratio":a}},"scroll-position":function(a,b){var c,d=this,e=d.attrs,f='horizontal'===e['scroll-orientation'],g=e['scroll-repaint'],h=e['scroll-position'],i=d._.scroller,j=i.anchor;return a=1<a?1:0>a?0:p(a),isNaN(a)&&(a=h),g&&(h!==a||b)&&(c=i.start&&i.start.attr(f&&'width'||'height')||0,f&&j.attr('x',g[0]+c+(g[2]-2*c-j.attr('width'))*a+.5)||j.attr('y',g[1]+c+(g[3]-2*c-j.attr('height'))*a+.5),!b&&1>e['scroll-ratio']&&(t('raphael.scroll.change.'+d.id,d,a),i.callback&&i.callback.call(d,a))),{"scroll-position":a}},r:function(a){var b=this,c=b._.scroller;return c.track.attr('r',a),c.anchor.attr('r','none'===b.attrs['scroll-display-buttons']&&a||0),!1},"scroll-repaint-horizontal":function(a,b,c,d){var e=this,f=e.attrs,g=e._.scroller,i=f['scroll-ratio'],j=f['scroll-position'],k=0,m=c*i,n='none'===f['scroll-display-buttons'];c&&(c-=1),a&&(a+=.5),d&&(d-=1),b&&(b+=.5),g.track.attr({width:c,height:d,y:b,x:a}).crisp(),n||(k=l(d,.5*c),m-=2*k*i,g.start.attr({width:k,height:d,x:a,y:b}),g.arrowstart.attr('polypath',[3,a+.5*k,b+.5*d,.25*k,180]),g.end.attr({width:k,height:d,x:a+c-k,y:b}),g.arrowend.attr('polypath',[3,a+c-.5*k,b+.5*k,.25*k,0])),g.trackLength=c-2*k-m,g.trackOffset=a+k+.5,g.anchorOffset=g.trackOffset+.5*(m-1),g.anchor.attr({height:1>d?1:d,width:1>m-1?1:m-1,y:b,x:g.trackOffset+g.trackLength*j}).crisp()},"scroll-repaint-vertical":function(a,b,c,d){var e=this,f=e.attrs,g=e._.scroller,i=f['scroll-ratio'],j=f['scroll-position'],k=0,m=d*i,n='none'===f['scroll-display-buttons'];c&&(c-=1),a&&(a+=.5),d&&(d-=1),b&&(b+=.5),g.track.attr({width:c,height:d,y:b,x:a}).crisp(),n||(k=l(c,.5*d),m-=2*k*i,g.start.attr({width:c,height:k,x:a,y:b}),g.arrowstart.attr('polypath',[3,a+.5*c,b+.5*k,.25*k,90]),g.end.attr({width:c,height:k,x:a,y:b+d-k}),g.arrowend.attr('polypath',[3,a+.5*c,b+d-.5*k,.25*k,-90])),g.trackLength=d-2*k-m,g.trackOffset=b+k+.5,g.anchorOffset=g.trackOffset+.5*(m-1),g.anchor.attr({height:1>m-1?1:m-1,width:1>c?1:c,y:g.trackOffset+g.trackLength*j,x:a}).crisp()},fill:function(a){var c,d=this,e=d.attrs,g=d._.scroller,h=e['scroll-repaint'],i='flat'===e['scroll-display-style'],j='horizontal'===e['scroll-orientation'],k={stroke:'none'};return f&&h&&3<(c=16-h[j&&3||2])&&(k.stroke=s,k['stroke-width']=0>c?0:c),a=b.color(a),a.error&&(a=b.color('#000000')),a='opacity'in a?'rgba('+[a.r,a.g,a.b,a.opacity]+')':'rgb('+[a.r,a.g,a.b]+')',k.fill=i&&a||[90*j,b.tintshade(a,.15).rgba,a].join('-'),k.stroke=b.tintshade(a,-.75).rgba,g.track.attr(k),k.fill=i&&b.tintshade(a,-.6).rgba||[270*j,b.tintshade(a,.3).rgba+':40',b.tintshade(a,-.7).rgba].join('-'),k.stroke=b.tintshade(a,-.6).rgba,g.anchor.attr(k),k.stroke='none','none'!==e['scroll-display-buttons']&&(k.fill=s,g.start.attr(k),g.end.attr(k),k.fill=b.tintshade(a,-.4).rgba,g.arrowstart.attr(k),g.arrowend.attr(k)),!1}}}]),b.ca['text-bound']=function(d,e,f,g,h,i,j){var k=this,l=k.paper,m=k._.textbound;if(this._origOpacity=j===c?1:j,'text'===this.type)return(!e||'none'===e||a.test(e))&&(!d||'none'===d||a.test(d))?(k._.textbound=m&&m.unfollow(k).remove(),!1):(k.attrs['text-bound']=arguments,f&&b.is(f,'finite')||(f=0),h&&b.is(h,'finite')||(h=0),m||(m=k._.textbound=l.rect(0,0,0,0,k.group).follow(k,b.ca['text-bound'].reposition,'before')),m.attr({stroke:e||'none',"stroke-width":f,fill:d||'none',"shape-rendering":1===f&&'crisp'||'',r:h}),j!==c&&m.attr('opacity',j),i&&m.attr('stroke-dasharray',i),b.ca['text-bound'].reposition.call(m,k.attr(),k),!1)},b.ca['text-bound'].reposition=function(a,b){var d,e,f,g,i,j,k,l,m,n=Math.max,r=this,o={};a.hasOwnProperty('visibility')&&r.attr('visibility',a.visibility);(a.hasOwnProperty('text-bound')||a.hasOwnProperty('x')||a.hasOwnProperty('y')||a.hasOwnProperty('text')||a.hasOwnProperty('text-anchor')||a.hasOwnProperty('text-align')||a.hasOwnProperty('font-size')||a.hasOwnProperty('line-height')||a.hasOwnProperty('vertical-align')||a.hasOwnProperty('transform')||a.hasOwnProperty('rotation')||a.hasOwnProperty('opacity'))&&(d=b.attrs,e=d['text-bound'],f=q(e&&e[3]||'0').split(u),g=p(f[0])||0,i=pluck(p(f[1]),g),j=b.getBBox(),l=j.width,m=j.height,r._origOpacity===c&&(r._origOpacity=1),k=p(a.opacity||d.opacity),o.opacity=isNaN(k)?r._origOpacity:r._origOpacity*k,!isNaN(l)&&(o.x=j.x-g,o.y=j.y-i,o.width=n(l+2*g,0),o.height=n(m+2*i,0)),r.attr(o))},b.fn.symbol=function(){var a,d=this,e=arguments,f=e.length-1,g=e[f];return g&&g.constructor===b.el.constructor?e[f]=c:g=c,a=d.path(c,g),a.ca.symbol=b.fn.symbol.ca.symbol,e.length===!!g+0?a:a.attr('symbol',e)},b.fn.getSuggestiveRotation=function(){var a,b,c,d;return a=arguments[0],1===arguments.length?(b=a.angle,c=a.x,d=a.y):(b=a,c=arguments[1],d=arguments[2]),b=b||0,'r'+b+','+c+','+d},b.fn.symbol.cache={"":b._cacher(function(a,b,c,d){return 3<arguments.length?['M',a,b,'h',c,'v',d,'h',-c,'v',-d,'z']:['M',a-c,b-c,'h',c*=2,'v',c,'h',-c,'v',-c,'z']})},b.fn.symbol.ca={symbol:function(a){var c,d,e=this,f=b.is(a,'object')&&1===arguments.length&&!b.is(a,'function')?a:arguments;f===a&&(a=f[0]),c=b.is(a,'function')&&a||b.fn.symbol.cache[a]||b.fn.symbol.cache[''],d=c&&c.apply(b,r.call(f,1)),b.is(d,'array')||b.is(d,'string')?e.attr('path',d):d&&e.attr(d)}},b.addSymbol=function(a,c){var d,e,f=b.fn.symbol.cache,g=[];for(e in d=b.is(c,'function')&&(d={},d[a]=c,d)||a,d)c=d[e],f[e]=b.is(c,'function')&&b._cacher(c,b)||(g.push(e),c);for(e=g.pop();e;)f[e]=f[f[e]],e=g.pop()}}